<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Kernel Development</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="../../css/style.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Kernel Development</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#what-is-memory">What is memory?</a></li>
<li><a href="#the-boot-process">The Boot Process</a></li>
<li><a href="#getting-setup-for-kernel-development">Getting setup for Kernel development</a></li>
<li><a href="#a-hello-world-bootloader">A Hello World Bootloader</a></li>
</ul>
</nav>
<p>This is based on a <a href="https://dragonzap.com/course/developing-a-multithreaded-kernel-from-scratch?coupon=YOUTUBEKERNEL2022">course</a> which guides the reader through the development of a full OS kernel, from a Hello World Bootloader to a multitasking kernel with a FAT16 file system. The first 11 lessons are available for free on <a href="https://www.youtube.com/watch?v=HNIg3TXfdX8&amp;list=PLrGN1Qi7t67V-9uXzj4VSQCffntfvn42v">YouTube</a></p>
<h2 id="what-is-memory">What is memory?</h2>
<p>Memory is a piece of hardware that allows computers to store information. Programs can read and write to <em>Random Access Memory</em> (RAM). It’s only used for temporary storage, such as for variable storage of the programs you write. RAM is wiped when you shut down the computer. <em>Read Only Memory</em> (ROM) does <em>not</em> vanish when you shut down the computer. But as the name suggests, you can’t write to it. In a home PC, the BIOS program is stored in ROM.</p>
<p>Memory is generally accessed in a linear fashion. The data is stored in order. The way your processor accesses memory abstracts this.</p>
<h2 id="the-boot-process">The Boot Process</h2>
<div class="tufte-section">
<div class="main-text">
<p>The boot process has three steps:</p>
<ol type="1">
<li>The BIOS<sup>1</sup> program is executed from ROM/BIOS Chip</li>
<li>The BIOS loads the <em>Bootloader</em> into memory address <code>0x7C00</code></li>
<li>The Bootloader loads the Kernel</li>
</ol>
<p>When the computer is switched on, the CPU will read from the BIOS ROM and start executing instructions it finds there. The BIOS usually loads itself into RAM for performance reasons and will continue to execute from there. The BIOS also identifies and initializes the computer’s hardware, such as disk drivers.</p>
<p>The final thing the BIOS does is try to find a Bootloader. It searches all available storage mediums - USB drives, hard disks - for the magic boot signature <code>0x55AA</code>. It will look in the last bytes of the first sector<sup>2</sup>, and if the signature is found, it will load that sector into address <code>0x7C00</code>, and the CPU will start to execute from that address.</p>
<p>When a computer first boots, it does so in <em>“Real Mode”</em>. This is a very limited ‘compatibility’ mode, with access to only 1Mb of memory, and it can only execute 16 bit code. The Bootloader is a small program whose job is to put the computer into <em>“Protected Mode”</em>, which allows 32 bit code and access to 4Gb of memory, and then to load the kernel of an operating system.</p>
<p>The BIOS contains routines that the bootloader uses to boot the kernel. The interfaces of BIOS routines are generic and standardized across manufacturers.</p>
</div>
<div class="sidenotes">
<p><sup>1</sup> Basic Input Output System</p>
<p><sup>2</sup> A sector is a block of storage. For example, a hard disk is made up of 512 byte sectors. The BIOS will look in the byte addresses 511 and 512 of the sector.</p>
</div>
</div>
<h2 id="getting-setup-for-kernel-development">Getting setup for Kernel development</h2>
<div class="tufte-section">
<div class="main-text">
<p>All development will be done on Ubuntu Linux. First, make sure your repositories are up to date with. Then, install nasm<sup>1</sup>. Finally, we will use the QEmu emulator to run our bootloader and kernel. Test that it runs using the below commands. A new window will pop up, but since there are no disks attached it won’t be able to boot.</p>
<pre><code>sudo apt update
sudo apt install nasm

sudo apt install qemu-system-x86
qemu-system-x86_64</code></pre>
</div>
<div class="sidenotes">
<p><sup>1</sup> NASM is the “Netwide Assembler”, and assembler for the x86 CPU architecture, compatible with nearly every modern platform. https://nasm.us</p>
</div>
</div>
<h2 id="a-hello-world-bootloader">A Hello World Bootloader</h2>
<p>Create a new folder / project <em>PeachOS</em>. Make a new file <em>boot.asm</em>.</p>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
<div class="tufte-section">
<div class="main-text">

</div>
<div class="sidenotes">

</div>
</div>
</body>
</html>
