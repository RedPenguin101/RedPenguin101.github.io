<html lang="" xml:lang="" xmlns="http://www.w3.org/1999/xhtml"><head>
  <meta charset="utf-8" />
  <meta content="pandoc" name="generator" />
  <meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport" />
  <title>2020_08_17_shadowcljs</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link href="../../css/style.css" rel="stylesheet" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="how-to-set-up-shadow-cljs">How to set up shadow-cljs</h1>
<h2 id="installation">Installation</h2>
<p>Note, this was written for Ubuntu linux. Other distros, Mac and
especially Windows will have differences in how you install these, but
each of them have good instructions.</p>
<p>You need 3 things to get shadow-cljs up and running.</p>
<ul>
<li>nodejs</li>
<li>npm (the node package manager, that comes with nodejs)</li>
<li>the shadow-cljs command line tool</li>
</ul>
<h3 id="install-nodejs">Install Nodejs</h3>
<p>https://github.com/nodesource/distributions/blob/master/README.md#installation-instructions</p>
<p>from the command line, add the node repository, and install node.
Here, we’re installing the LTS variant.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a><span class="co"># Using Ubuntu</span></span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sL</span> https://deb.nodesource.com/setup_lts.x <span class="kw">|</span> <span class="fu">sudo</span> <span class="at">-E</span> bash <span class="at">-</span></span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a><span class="fu">sudo</span> apt-get install <span class="at">-y</span> nodejs</span></code></pre></div>
<h3 id="install-shadow-cljs">Install Shadow-cljs</h3>
<p>This will install shadow-cljs globally. It’s the most convenient way
to use it.</p>
<p><code>sudo npm install -g shadow-cljs</code></p>
<h2 id="project-setup">Project Setup</h2>
<h3 id="quick-reference">Quick reference</h3>
<ul>
<li><code>npm init</code></li>
<li><code>npm install --save-dev shadow-cljs</code></li>
<li><code>shadow-cljs init</code></li>
<li>update package.json to include react</li>
<li>update shadow-cljs.edn per below</li>
<li>create public/index.html per below</li>
<li>create src/[projectname]/main/main.cljs per below</li>
<li>run <code>shadow-cljs watch app</code> and watch the build log</li>
<li>go to http://localhost:9090/ to check your app is running - you
should see “hello world” on the page</li>
<li>change the text of the h1 element in main.cljs, save the file and
make sure it updates in your browser.</li>
</ul>
<h3 id="detailed">Detailed</h3>
<p>From the terminal:</p>
<p>Create the directory you want to make your project in.</p>
<p>Run <code>npm init</code> to initiate the project. This will create a
package.json file, where your npm dependencies will live</p>
<p>Run <code>npm install --save-dev shadows-cljs</code>. This installs
shadow-cljs locally (in the previous section you installed it globally).
the <code>--save-dev</code> flag puts the dependency in your
package.json file.</p>
<p>Run <code>shadow-cljs init</code> to initiate the shadow-cljs
project. This will create a shadow-cljs.edn, which is where all your
<em>clojurescript</em> dependencies go, and also where your build
instructions live. It tells shadow-cljs where to run the dev-server,
where to look for the main function, and where to output the compiled
javascript.</p>
<p>Update shadow-cljs.edn using the below config. Here’s an explanation
of the parts</p>
<ul>
<li>At the top you have the source paths. These are the paths that
shadow-cljs will be able to access when it’s looking for source
code</li>
<li>dependencies - the clojar resources that you want in your project.
reagent and re-frame are two of the most common for most
applications.</li>
<li>dev-http - this is the port that shadow will launch the dev-server
on. So when you run the app, you can go to http://localhost:9090 to see
your running application</li>
<li>builds - this is an edn map where each key is a build. When you run
your app with shadow-cljs from the command line, you’ll tell it which
build to use. Here it’s ‘app’</li>
<li>output-dir - this is where shadow-cljs will put the compiled js.
It’s important that this path is never touched by anything except
shadow-cljs. the path is relative to the project root</li>
<li>asset-path - where shadow will look for js asset when launching.
This is relative to the <em>index.html</em> file that is being used for
the app</li>
<li>target - tells shadow that this is a web app, as opposed to a node
back-end app</li>
<li>modules - here you’ll tell shadow-cljs what function to run to
launch the application. Here it will look for the <code>main</code>
function in the file (relative to the root)
<em>src/main/my_project/main.cljs</em></li>
<li>devtools - Misc stuff that shadow will do when in dev mode
(i.e. when you use <code>shadow-cljs watch app</code>.
<code>:after-load</code> will tell it to run the <code>reload</code>
function in <em>src/main/my_project/mains.cljs</em> every time you
reload the application (which is every time you save a source file
you’re editing)</li>
</ul>
<p>Create a file <em>public/index.html</em> and put the below in it.</p>
<ul>
<li>the ‘app’ div is where we will be mounting our application</li>
<li>the <code>script</code> is pointing our compiled js from the
shadow-cljs.edn file we configured above</li>
</ul>
<p>Create the file <em>src/main/my-project/main.cljs</em> and put the
below code in it.</p>
<ul>
<li>the <code>app</code> is your app - it’s what is turned into html and
rendered in the page</li>
<li>the <code>mount</code> uses reagent to get the <code>app</code> and
render it in the html index page we set up - specifically under the div
with if <code>app</code> we set up in that file</li>
<li>the <code>main</code> is what’s called on initialization of the app.
Here it just calls <code>mount</code>. This is one of the things we
pointed shadow-cljs.edn to</li>
<li>the <code>reload</code> does the same thing, but is only called when
the app is reloaded. Again, this is what pointed shadow-cljs to.</li>
</ul>
<p>Run <code>shadow-cljs watch app</code> from the project root
directory. This will launch the application</p>
<p>Watch the build script - on the first launch it will update any
dependencies necessary (including adding them to your package.json),
launch all the infrastructure, and compile your clojurescript files to
js, outputting them to where you instructed it. It will take a while to
actually launch, because it has to compile everything. On reload (when
you edit and save a .cljs file) it will only have to compile the changed
files, so will be much quicker.</p>
<p>Once the build is complete, navigate your browser to
http://localhost:9090/. You should see “hello world” in an h1 block
(from your <code>app</code> function in main.cljs).</p>
<p>Next, make sure the ‘reload’ is working properly - while the app is
running, go to main.cljs and change the text in the h1 div from “hello
world” to something else. When you save, your terminal should show that
the project is recompiling, and your browser should quickly reflect the
changed text.</p>
<h2 id="further-resources">Further resources</h2>
<p>For actually learning how build a clojurescript application with
reagent and re-frame, I recommend Eric Normands various courses. They’re
not free, but the quality is excellent, and he explains how all the
pieces work very well.</p>
<ul>
<li>https://purelyfunctional.tv/courses/markdown-editor/[Your first
re-frame app - a markdown editor]</li>
<li>https://purelyfunctional.tv/courses/understanding-re-frame/[Understanding
re-frame] (and reagent, and react, and the DOM)</li>
<li>https://purelyfunctional.tv/courses/building-re-frame-components/[Building
re-frame components]</li>
</ul>
<h2 id="file-templates">File templates</h2>
<h3 id="package.json">package.json</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;qniform&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a>  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.0&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a>  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a>  <span class="dt">&quot;main&quot;</span><span class="fu">:</span> <span class="st">&quot;index.js&quot;</span><span class="fu">,</span></span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6" tabindex="-1"></a>  <span class="dt">&quot;author&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb2-7"><a aria-hidden="true" href="#cb2-7" tabindex="-1"></a>  <span class="dt">&quot;license&quot;</span><span class="fu">:</span> <span class="st">&quot;ISC&quot;</span><span class="fu">,</span></span>
<span id="cb2-8"><a aria-hidden="true" href="#cb2-8" tabindex="-1"></a>  <span class="dt">&quot;devDependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-9"><a aria-hidden="true" href="#cb2-9" tabindex="-1"></a>    <span class="dt">&quot;shadow-cljs&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.20.1&quot;</span></span>
<span id="cb2-10"><a aria-hidden="true" href="#cb2-10" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb2-11"><a aria-hidden="true" href="#cb2-11" tabindex="-1"></a>  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-12"><a aria-hidden="true" href="#cb2-12" tabindex="-1"></a>    <span class="dt">&quot;react&quot;</span><span class="fu">:</span> <span class="st">&quot;^18.2.0&quot;</span><span class="fu">,</span></span>
<span id="cb2-13"><a aria-hidden="true" href="#cb2-13" tabindex="-1"></a>    <span class="dt">&quot;react-dom&quot;</span><span class="fu">:</span> <span class="st">&quot;^18.2.0&quot;</span></span>
<span id="cb2-14"><a aria-hidden="true" href="#cb2-14" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-15"><a aria-hidden="true" href="#cb2-15" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="shadow-cljs.edn">shadow-cljs.edn</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a><span class="co">;; shadow-cljs configuration</span></span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a>{<span class="at">:source-paths</span></span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a> [<span class="st">&quot;src/dev&quot;</span></span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4" tabindex="-1"></a>  <span class="st">&quot;src/main&quot;</span></span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5" tabindex="-1"></a>  <span class="st">&quot;src/test&quot;</span>]</span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7" tabindex="-1"></a> <span class="at">:dependencies</span></span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8" tabindex="-1"></a> [[reagent <span class="st">&quot;1.0.0-alpha2&quot;</span>]</span>
<span id="cb3-9"><a aria-hidden="true" href="#cb3-9" tabindex="-1"></a>  [re-frame <span class="st">&quot;1.0.0&quot;</span>]]</span>
<span id="cb3-10"><a aria-hidden="true" href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a aria-hidden="true" href="#cb3-11" tabindex="-1"></a> <span class="at">:dev-http</span> {<span class="dv">9090</span> <span class="st">&quot;public/&quot;</span>}</span>
<span id="cb3-12"><a aria-hidden="true" href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a aria-hidden="true" href="#cb3-13" tabindex="-1"></a> <span class="at">:builds</span></span>
<span id="cb3-14"><a aria-hidden="true" href="#cb3-14" tabindex="-1"></a> {<span class="at">:app</span> {<span class="at">:output-dir</span> <span class="st">&quot;public/compiledjs/&quot;</span></span>
<span id="cb3-15"><a aria-hidden="true" href="#cb3-15" tabindex="-1"></a>        <span class="at">:asset-path</span> <span class="st">&quot;compiledjs&quot;</span></span>
<span id="cb3-16"><a aria-hidden="true" href="#cb3-16" tabindex="-1"></a>        <span class="at">:target</span>     <span class="at">:browser</span></span>
<span id="cb3-17"><a aria-hidden="true" href="#cb3-17" tabindex="-1"></a>        <span class="at">:modules</span>    {<span class="at">:main</span> {<span class="at">:init-fn</span> my-project.main/main}}</span>
<span id="cb3-18"><a aria-hidden="true" href="#cb3-18" tabindex="-1"></a>        <span class="at">:devtools</span>   {<span class="at">:after-load</span> my-project.main/reload}}}}</span></code></pre></div>
<h3 id="index.html">Index.html</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb4-1"><a aria-hidden="true" href="#cb4-1" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;<span class="dt">&gt;</span></span>
<span id="cb4-2"><a aria-hidden="true" href="#cb4-2" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span> <span class="er">lang</span><span class="ot">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb4-3"><a aria-hidden="true" href="#cb4-3" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb4-4"><a aria-hidden="true" href="#cb4-4" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb4-5"><a aria-hidden="true" href="#cb4-5" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb4-6"><a aria-hidden="true" href="#cb4-6" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">div</span> <span class="er">id</span><span class="ot">=</span><span class="st">&quot;app&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span> </span>
<span id="cb4-7"><a aria-hidden="true" href="#cb4-7" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">script</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;/compiledjs/main.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb4-8"><a aria-hidden="true" href="#cb4-8" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb4-9"><a aria-hidden="true" href="#cb4-9" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="main.cljs">main.cljs</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb5-1"><a aria-hidden="true" href="#cb5-1" tabindex="-1"></a>(<span class="kw">ns</span> my-project.<span class="kw">main</span></span>
<span id="cb5-2"><a aria-hidden="true" href="#cb5-2" tabindex="-1"></a>  (<span class="at">:require</span> [reagent.core <span class="at">:as</span> r]</span>
<span id="cb5-3"><a aria-hidden="true" href="#cb5-3" tabindex="-1"></a>            [reagent.dom <span class="at">:as</span> rd]))</span>
<span id="cb5-4"><a aria-hidden="true" href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a aria-hidden="true" href="#cb5-5" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> app </span>[]</span>
<span id="cb5-6"><a aria-hidden="true" href="#cb5-6" tabindex="-1"></a>  [<span class="at">:div</span></span>
<span id="cb5-7"><a aria-hidden="true" href="#cb5-7" tabindex="-1"></a>   [<span class="at">:h1</span> <span class="st">&quot;hello world&quot;</span>]])</span>
<span id="cb5-8"><a aria-hidden="true" href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a aria-hidden="true" href="#cb5-9" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> mount </span>[]</span>
<span id="cb5-10"><a aria-hidden="true" href="#cb5-10" tabindex="-1"></a>  (rd/render [app]</span>
<span id="cb5-11"><a aria-hidden="true" href="#cb5-11" tabindex="-1"></a>             (.getElementById js/document <span class="st">&quot;app&quot;</span>)))</span>
<span id="cb5-12"><a aria-hidden="true" href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a aria-hidden="true" href="#cb5-13" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> main </span>[]</span>
<span id="cb5-14"><a aria-hidden="true" href="#cb5-14" tabindex="-1"></a>  (mount))</span>
<span id="cb5-15"><a aria-hidden="true" href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a aria-hidden="true" href="#cb5-16" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> reload </span>[]</span>
<span id="cb5-17"><a aria-hidden="true" href="#cb5-17" tabindex="-1"></a>  (mount))</span></code></pre></div>


</body></html>