<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Structure and interpretation of computer programs</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Structure and interpretation of computer programs</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_building_abstractions_with_procedures">Building Abstractions with procedures</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Computational process</strong>: abstract being that inhabits a computer. Manipulate <strong>data</strong>. Directed by <strong>programs</strong>.</p>
</div>
<div class="paragraph">
<p>Well designed programs are designed in a modular manner, so the parts can be constructed, replaced and debugged separately.</p>
</div>
<div class="sect2">
<h3 id="_the_elements_of_programming">The elements of programming</h3>
<div class="paragraph">
<p>Languages have three mechanisms for combining simple ideas into more complex ones.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>primitive expressions</strong></p>
</li>
<li>
<p><strong>means of combination</strong>, where compound elements are built from simpler ones</p>
</li>
<li>
<p><strong>means of abstraction</strong>, where compound elements can be named and manipulated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Data</strong> is the stuff that is manipulated by <strong>procedures</strong>.</p>
</div>
<div class="paragraph">
<p>An expression is something that can be evaluated. Expressions can be grouped in parens, forming <em>combinations</em>. In prefix notation, the leftmost expression is the <em>operator</em>, and the other are the <em>operands</em>. The operator is applied to the operands.</p>
</div>
<div class="paragraph">
<p>Names can refer to computational objects. The name is the <em>variable</em> and the object is the <em>value</em>. The variable is <em>defined</em> as referring to the object. Definition is the simplest form of abstraction.</p>
</div>
<div class="paragraph">
<p>Definition can be repeated to build ever more complex things from simpler things, creating a tower of abstraction. This has the benefit of modularity: the ability to build complex things step by step from small procedures.</p>
</div>
<div class="paragraph">
<p>name/value pairs are maintained in the <em>global environment</em>.</p>
</div>
<div class="paragraph">
<p>To evaluate a combination:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>evaluate its subexpressions and substitute them for their values</p>
</li>
<li>
<p>apply the operator to the operands</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note this is recursive.</p>
</div>
<div class="paragraph">
<p>Evaluation can take place in different orders. Namely, applicative order is the 'evaluate the arguments and then apply' model, whereas normal order is 'fully expand and then reduce'.</p>
</div>
<div class="paragraph">
<p>A <strong>predicate</strong> is a procedure that returns true or false.</p>
</div>
<div class="paragraph">
<p>Procedures are analogous to mathematical functions, with one addition: they must be effective. Consider a mathematical function <code>sqrt x = y ST y&gt;=0 and y^2 = x</code>. This is not enough to make a procedure, because it doesn&#8217;t tell you <em>how</em> to get to y. A procedure must be executable. A procedure must be imperative.</p>
</div>
<div class="paragraph">
<p>A method for calculating square roots is using a specific case of Newton&#8217;s method for successive approximations.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Guess y</p>
</li>
<li>
<p>If y is good enough, stop</p>
</li>
<li>
<p>otherwise, average y with x/y to get the next guess</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn good-enough? [guess x] (&lt; (Math/abs (double (- (* guess guess) x))) 0.001))

(defn improve [guess x] (/ (+ guess (/ x guess)) 2))

(defn sqrt-iter [guess x]
  (if (good-enough? guess x)
    guess
    (sqrt-iter (improve guess x) x)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Computing square roots like this breaks up into a number of sub-problems, each having a procedure. Any program can be divided into parts in many ways. The point is to divide it such that each part accomplishes an identifiable and independently meaningful task. In this way, we may treat each subcomponent as a black box. When I am developing <code>sqrt-iter</code>, I don&#8217;t <em>need</em> to know how George is implementing <code>improve</code>, only that it returns an improved guess. The detail is suppressed. From this perspective, it is a <strong>procedural abstraction</strong>.</p>
</div>
<div class="paragraph">
<p>The procedure <code>(defn square [x] (* x x))</code> has the name <code>x</code> that is local to its scope. It is a <strong>bound variable</strong> - the procedure definition <em>binds</em> its formal parameters. If a variable is not bound, it is <strong>free</strong>. In <code>(defn sum-of-squares [x y] (+ (square x) (square y)))</code>, <code>square</code> is a free variable.</p>
</div>
<div class="paragraph">
<p>We can take advantage of <strong>lexical scoping</strong> to simplify (and limit the scope of) our procedures. Note in the following how <code>good-enough?</code> and <code>improve</code> now take a single input: guess, since <code>x</code> is bound in the lexical scope of the block that these functions exist in, it can be a free variable in those definitions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn sqrt [x]
  (letfn [(good-enough? [guess] (&lt; (Math/abs (double (- (* guess guess) x))) 0.001))
          (improve [guess] (/ (+ guess (/ x guess)) 2))
          (sqrt-iter [guess x] (if (good-enough? guess) guess (sqrt-iter (improve guess) x)))]
    (sqrt-iter 1 x)))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_procedures_and_the_processes_they_generate">Procedures and the processes they generate</h3>
<div class="paragraph">
<p>A procedure describes the local evolution of a process. Learning to visualize the evolution is crucial to being a good programmer.</p>
</div>
<div class="paragraph">
<p>Processes, as they evolve, take up time and space.</p>
</div>
<div class="paragraph">
<p>Consider the factorial function <code>n! = n * (n-1) * (n-2) &#8230;&#8203; 3 * 2 * 1</code>, and observe that <code>n!=n*(n-1)!</code>. In other words, this can be defined recursively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn factorial [n] (if (= n 1) 1 (* n (factorial (dec n)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can, by substitution, see that this will evolve thus:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/book_sicp/1_2_1_linear_recursive.gif" alt="1 2 1 linear recursive">
</div>
</div>
<div class="paragraph">
<p>And you can see it&#8217;s O(N) in both time (vertical) and space (horizontal)</p>
</div>
<div class="paragraph">
<p>If you define factorial differently, like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn factorial
  ([n] (factorial 1 1 n))
  ([acc i n] (if (= n i) (* acc i) (factorial (* acc i) (inc i) n))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process evolves differently:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/book_sicp/1_2_2_iterative.gif" alt="1 2 2 iterative">
</div>
</div>
<div class="paragraph">
<p>Still O(N) in time, but now only O(1) in space.</p>
</div>
<div class="paragraph">
<p>In the first case, the process builds up a chain of <em>deferred operations</em>.</p>
</div>
<div class="paragraph">
<p>The first case is called a <strong>linear recursive process</strong>, the second an <strong>linear iterative process</strong>. (not to be confused with a <strong>recursive procedure</strong>, which is just a procedure which calls itself.)</p>
</div>
<div class="paragraph">
<p>In addition to the difference in space, note that the iterative process the variables contain the complete state of the process at all times. That&#8217;s not true with the recursive case.</p>
</div>
<div class="paragraph">
<p>A third common pattern is <strong>tree recursion</strong>. Consider the fibonacci procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn fib [n] (if (&lt; n 2) n (+ (fib (- n 1)) (fib (- n 2)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This process evolves like this</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/book_sicp/1_2_3_tree_rec.gif" alt="1 2 3 tree rec">
</div>
</div>
<div class="paragraph">
<p>Because each call to <code>fib</code> calls itself twice, the result is a tree of recursive calls. Note that this is extremely inefficient, because there are redundant calculations: <code>(fib 3)</code> is recalculated twice completely independently.</p>
</div>
<div class="paragraph">
<p>One can create a more efficient, linearly iterative implementation of fib:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn fib-iter [a b count] (if (zero? count) b (fib-iter (+ a b) a (dec count))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consider the problem of computing the exponential of a given number. This can be computed recursively or iteratively</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn expt [b n] (if (zero? n) 1 (* b (expt b (dec n)))))

(defn expt-iter [b counter product]
  (if (zero? counter) product (expt-iter b (dec counter) (* b product))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are both O(n) in time. We can reduce this to O(log n) in time <em>and</em> space by using successive squaring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn fast-exp [b n]
  (cond (zero? n) 1
        (even? n) (square (fast-exp b (/ n 2)))
        :else (* b (fast-exp b (- n 1)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this is again recursive. Making this iterative is tough (and an exercise).</p>
</div>
</div>
<div class="sect2">
<h3 id="_formulating_abstractions_with_higher_order_functions">Formulating abstractions with higher order functions</h3>
<div class="paragraph">
<p>We&#8217;ve seen that procedures are abstractions of compound operations.</p>
</div>
<div class="paragraph">
<p>A limitation of what we&#8217;ve seen so far is that you can only create abstractions across data inputs. To take it to the next level, you want to be able to construct procedures that accept and apply <em>other procedures</em>. Such things are called <strong>higher order procedures</strong>.</p>
</div>
<div class="paragraph">
<p>Consider the two functions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn sum-integers [a b] (if (&gt; a b) 0 (+ a (sum-integers (+ a 1) b))))
(defn sum-cubes    [a b] (if (&gt; a b) 0 (+ (cube a) (sum-cubes (+ a 1) b))))
(defn pi-sum       [a b] (if (&gt; a b) 0 (+ (/ 1 (* a (+ a 2))) (pi-sum (+ a 4) b))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Clearly these share a lot of similarity. They all follow the pattern</p>
</div>
<div class="paragraph">
<p><code>(defn name [a b] (if (&gt; a b) 0 (+ (term a) (name (next a) b))))</code></p>
</div>
<div class="paragraph">
<p>This indicates an underlying pattern worthy of higher level abstraction - and indeed, this is the expression of the 'summation of a series', or sigma notation. <code>Î£f(n)</code>. This allows mathematicians to express the concept of summation independent of what is actually being summed. We can do the same thing using higher order functions. In the following, term and next are procedures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn sum [term a next b] (if (&gt; a b) 0 (+ (term a) (pi-sum (next a) b))))
(sum identity 5 inc 10) ;; equivalent to sum-integers
(defn sum-cubes [a b] (sum cube a inc b))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a little clumsy, because we&#8217;re required to define (and name) the term and next function each time we want to use it. We can get around that by using <strong>anonymous functions</strong>, or <strong>lambdas</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn pi-sum [a b] (sum (fn [x] (/ 1 (* x (+ x 2))) a (fn [x] (+ x 4) b))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Passing in functions as arguments means we can use procedures to express general method of computation, like we did with <code>sum</code>. Here are a couple of more elaborate examples.</p>
</div>
<div class="paragraph">
<p>The half-interval method find roots of equations. If <code>f(a)&lt;0&lt;f(b)</code>, then f must have a root in the interval a b. By averaging a and b we can recursively narrow on to that root</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn close-enough? [a b]
  (&lt; (Math/abs (- a b)) 0.001))

(defn search [f a b]
  (let [mid (average a b)]
    (if (close-enough? a b)
      mid
      (let [test (f mid)]
        (cond (pos? test) (search f a mid)
              (neg? test) (search f mid b)
              :else mid)))))

(defn half-interval [f a b]
  (let [fa (f a) fb (f b)]
    (cond (&lt; fa 0 fb) (search f a b)
          (&lt; fb 0 fa) (search f b a)
          :else "Error: values are not of opposite sign")))

(half-interval #(Math/sin %) 2.0 4.0)
;; =&gt; 3.14111328125
(half-interval #(- (cube %) (* 2 %) 3) 1.0 2.0)
;; =&gt; 1.89306640625</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finding the fixed point of a function (where <code>f(x)=x</code>) can be done in a similar way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn fixed-point [f first-guess]
  (letfn [(close-enough? [v1 v2] (&lt; (Math/abs (- v1 v2)) 0.00001))
          (try* [guess] (let [next (f guess)] (if (close-enough? guess next) next (try* next))))]
    (try* first-guess)))

(fixed-point #(Math/cos %) 1.0)
;; =&gt; 1.0
(fixed-point #(+ (Math/sin %) (Math/cos %)) 1.0)
;; =&gt; 1.2587315962971173</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is effectively an abstraction on the method for finding square roots we looked at earlier, and we can create a sqrt fn like <code>(defn sqrt [x] (fixed-point (fn [y] (/ x y)) 1.0))</code>. However note that this would fail to converge because guesses would repeat. Hence we need to define f to be <code>(average y (/ x y))</code> - exactly as we did above. This pattern of preventing the guesses from changing too much is called <strong>average damping</strong></p>
</div>
<div class="paragraph">
<p>We saw how allowing procedures to be passed as arguments we can make our procedures more expressive and general. We can further enhance this by allowing functions to be <em>returned</em> from procedures. Take the average damping process mentioned above. A 1-arity function can be transformed to an average damped version like <code>(defn average-damp [f] (fn [x] (average x (f x))))</code>. Our sqrt function can now be defined as <code>(defn sqrt [x] (fixed-point (average-damp (fn [y] (/ x y))) 1.0))</code>.</p>
</div>
<div class="paragraph">
<p>Note now that the 3 ideas that comprise the method of squaring are <em>totally explicit</em>: fixed-point search, average damping, and the function <code>x/y</code>. The outcome, and even the way the process evolves is identical to our original sqrt function, but the <em>idea</em> of what it is doing is so much clearer. In addition, the individual ideas can now be reused in other contexts. An experienced programmer can express her ideas in this clear and modular way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_newtons_method">Newtons Method</h3>
<div class="paragraph">
<p>We&#8217;ve been playing with Newton&#8217;s method for a while without expressing exactly what it is. It is the use of the fixed point method to approximate a solution of an equation. If <code>g(x)</code> is a differentiable function, then the solution of the equation <code>g(x)=0</code> is the fixed point of <code>f(x)</code> (i.e. <code>f(x)=x</code>), where <code>f(x)=x - g(x)/Dg(x)</code>, where <code>Dg(x)</code> is the derivative of g evaluated at x.</p>
</div>
<div class="paragraph">
<p>We can express the idea of a 'derivative' as <code>Dg(x) = (g(x+dx)-g(x)) / dx</code>.</p>
</div>
<div class="paragraph">
<p>So we can express this idea with a procedure, and use it to calculate the derivative of <code>g(x)=x^3</code> at <code>x=5</code>, which computationally we know is <code>3^x2</code>, or 75 at x=5.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(def dx 0.00001)
(defn deriv [g] (fn [x] (/ (- (g (+ x dx)) (g x)) dx)))
((deriv cube) 5)
;; =&gt; 75.00014999664018</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can express Newton&#8217;s method more generally, and use it in an even more explicit version of sqrt:</p>
</div>
<div class="paragraph">
<p>(defn newton-transform [g]
  (fn [x] (- x (/ (g x) deriv g) x)))
(defn newtons-method [g guess]
  (fixed-point (newton-transform g) guess))
(defn sqrt [x] (newtons-method #(- (square %) x) 1.0))
(sqrt 2)
;; &#8658; 1.4142135623822438</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>As programmers, we should be alert to opportunities to identify the underlying abstractions in our programs and to build upon them and generalize them to create more powerful abstractions. This is not to say that one should always write programs in the most abstract way possible; expert programmers know how to choose the level of abstraction appropriate to their task. But it is important to be able to think in terms of these abstractions, so that we can be ready to apply them in new contexts. The significance of higher-order procedures is that they enable us to represent these abstractions explicitly as elements in our programming language, so that they can be handled just like other computational elements.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_abstractions_with_data">Building abstractions with data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we&#8217;ve looked at procedural abstractions operating on numerical data. Usually, we&#8217;ll need to build more complex abstractions on data types themselves. In particular, <em>compound data types</em>. Similarly to procedural abstractions, this will allow us to elevate the conceptual level at which we can design our programs.</p>
</div>
<div class="paragraph">
<p>Consider rational numbers (i.e. those that can be expressed as x/y, where x and y are integers). We could design a program where we we deal with and track numerators and denominators separately. But it would be better if we could 'glue together' the two numbers, and deal with them as a single thing, and we can separate how we deal with rational numbers from their concrete representation, such separation forming an <strong>abstraction barrier</strong> between different parts of a program.</p>
</div>
<div class="sect2">
<h3 id="_introduction_to_data_abstraction">Introduction to data abstraction</h3>
<div class="paragraph">
<p>A data abstraction is when you use compound data objects so that they operate on abstract data. The concrete data representation is defined independently from the programs that use the data. We use <strong>selectors</strong> and <strong>constructors</strong> to interface between the two thing.</p>
</div>
<div class="paragraph">
<p>Consider an API for a rational numbers abstraction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(make-rat &lt;n&gt; &lt;d&gt;)
(numer &lt;x&gt;)
(denom &lt;x&gt;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example of the <strong>wishful thinking</strong> strategy. We haven&#8217;t talked about how this will be implemented, only the operations we would like to use to interact with rationals. Using these, we can trivially implement higher level operations on rationals:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn add-r [x y]
  (make-rat (+ (* (numer x1) (denom x2)) (* (numer x2) (denom x1)))
            (* (denom x1) (denom x2))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can implement a data structure for rationals with a pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn make-rat [n d] (list n d))
(defn numer [x] (first x))
(defn denom [x] (second x))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that make-rat doesn&#8217;t reduce its arguments to the gcd, but can be made to do so trivially.</p>
</div>
<div class="paragraph">
<p>We can envision this schema as a series of abstraction barriers, where at each level separated by a barrier, the level doesn&#8217;t need to know how the implementation below it works. This makes programs easier to maintain and modify, since provided we don&#8217;t change the API, we can change how lower level procedures are implemented without breaking the client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=== Programs that use rational number ===
    Rational numbers in problem domain
========= add-rat, sub-rat etc. =========
    Rational numbers as numer / denom
======= make-rat, numer, denom ==========
       Rational numbers as pairs
========= list, first, second ===========
    Language implementation of lists</pre>
</div>
</div>
<div class="paragraph">
<p>It is worth pausing to consider what we mean by data. We implemented rationals with <code>list</code> <code>first</code> and <code>second</code> above, but we don&#8217;t know how the language implements them. We assume there is some underlying 'stuff' which allows us to glue together two numbers and then later retrieve them. In fact we can easily implement these without any such underlying data, using only procedures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn list [x y]
  (fn [m]
    (cond (= m 0) x
          (= m 1) y
          :else (throw (ex-info "Argument not 0 or 1" [x y m])))))

(defn first [z] (z 0))
(defn second [z] (z 1))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_hierarchical_data_and_the_closure_property">2.2 Hierarchical data and the closure property</h3>

</div>
<div class="sect2">
<h3 id="_symbolic_data">Symbolic data</h3>
<div class="sect3">
<h4 id="_symbolic_differentiation_example">Symbolic differentiation example</h4>
<div class="paragraph">
<p>We will write a program to do automatic differentiation, encoding the following rules:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/book_sicp/1_2_4_diffs1.gif" alt="1 2 4 diffs1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/book_sicp/1_2_4_diffs2.gif" alt="1 2 4 diffs2">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/book_sicp/1_2_4_diffs3.gif" alt="1 2 4 diffs3">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/book_sicp/1_2_4_diffs4.gif" alt="1 2 4 diffs4">
</div>
</div>
<div class="paragraph">
<p>Our initial evaluator looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn deriv [exp var]
  (cond (number? exp) 0
        (variable? exp) (if (same-variable? exp var) 1 0)
        (sum? exp) (make-sum (deriv (addend exp) var)
                             (deriv (augend exp) var))
        (product? exp) (make-sum (make-product (multiplier exp)
                                               (deriv (multiplicand exp) var))
                                 (make-product (deriv (multiplier exp) var)
                                               (multiplicand exp)))
        :else (throw (ex-info "unknown expression type -- DERIV" exp))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>With one cond branch for each rule. There are a number of procedures we need to create (number? is a built-in in Clojure). To do that, we need to decide on a representation of an expression to be evaluated. Since we have perfectly good list-syntax, with <code>+</code> and <code><strong></code> we can use that. So the exp in the above will look like <code>'(</strong> (* x y) (+ x 3))</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(def variable? symbol?)
(defn same-variable? [a b] (and (every? symbol? [a b]) (= a b)))
(defn sum? [expr] (and (seq expr) (= (first expr) '+)))
(defn product? [expr] (and (seq expr) (= (first expr) '*)))
(defn make-sum [e1 e2] (list '+ e1 e2))
(defn make-product [e1 e2] (list '* e1 e2))
(defn addend [expr] (nth expr 1))
(defn augend [expr] (nth expr 2))
(defn multiplier [expr] (nth expr 1))
(defn multiplicand [expr] (nth expr 2))

(deriv 1 'x)
;; =&gt; 0
(deriv '(+ x 3) 'x)
;; =&gt; (+ 1 0)
(deriv '(* x y) 'x)
;; =&gt; (+ (* x 0) (* 1 y))
(deriv '(* (* x y) (+ x 3)) 'x)
;; =&gt; (+ (* (* x y) (+ 1 0)) (* (+ (* x 0) (* 1 y)) (+ x 3)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, the terms aren&#8217;t being simplified. <code>(+ (* x 0) (* 1 y))</code> is obviously just <code>y</code>.</p>
</div>
<div class="paragraph">
<p>We can fix that by iterating our make-sum and make-product so they handle the cases where both values are numbers, the identity cases, and (for multiplication) the null cases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn make-sum [e1 e2]
  (cond (every? number? [e1 e2]) (+ e1 e2)
        (and (number? e1) (zero? e1)) e2
        (and (number? e2) (zero? e2)) e1
        :else (list '+ e1 e2)))

(defn make-product [e1 e2]
  (cond (every? number? [e1 e2]) (* e1 e2)
        (and (number? e1) (zero? e1)) 0
        (and (number? e1) (= 1 e1)) e2
        (and (number? e2) (zero? e2)) 0
        (and (number? e2) (= 1 e2)) e1
        :else (list '* e1 e2)))

(deriv 1 'x)
;; =&gt; 0
(deriv '(+ x 3) 'x)
;; =&gt; 1
(deriv '(* x y) 'x)
;; =&gt; y
(deriv '(* (* x y) (+ x 3)) 'x)
;; =&gt; (+ (* x y) (* y (+ x 3)))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hierarchical_data_and_the_closure_property">Hierarchical Data and the Closure property</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_modularity_objects_and_state">Modularity, objects and state</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_metalinguistic_abstraction">Metalinguistic abstraction</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_computing_with_register_machines">Computing with register machines</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_exercises">Exercises</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_chapter_2">Chapter 2</h3>
<div class="paragraph">
<p><strong>Exercise 2.1</strong> Define a better version of make-rat that handles both positive and negative arguments. Make-rat should normalize the sign so that if the rational number is positive, both the numerator and denominator are positive, and if the rational number is negative, only the numerator is negative.</p>
</div>
<div class="paragraph">
<p><strong>Answer 2.1</strong> First figure out the decision tree:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Table</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">XPos</th>
<th class="tableblock halign-left valign-top">XNeg</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YPos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x/y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x/y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YNeg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-x/-y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-x/-y</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Simple enough: if y is negative, then you want to negate both x and y. Otherwise don&#8217;t. That&#8217;s the only test you need.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn make-rat [x y]
  (let [g (gcd x y) x (/ x g) y (/ y g)]
    (if (pos? y) (list x y)
        (list (- x) (- y)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Exercise 2.2</strong> Consider the problem of representing line segments in a plane. Each segment is represented as a pair of points: a starting point and an ending point. Define a constructor make-segment and selectors start-segment and end-segment that define the representation of segments in terms of points. Furthermore, a point can be represented as a pair of numbers: the x coordinate and the y coordinate. Accordingly, specify a constructor make-point and selectors x-point and y-point that define this representation. Finally, using your selectors and constructors, define a procedure midpoint-segment that takes a line segment as argument and returns its midpoint (the point whose coordinates are the average of the coordinates of the endpoints). To try your procedures, you&#8217;ll need a way to print points</p>
</div>
<div class="paragraph">
<p><strong>Answer 2.2</strong> The intended lesson here is making pairs of pairs (a segment is a pair of points, which is a pair of x y coordinates.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn make-point [x y] (list x y))
(defn x-point [p] (first p))
(defn y-point [p] (second p))
(defn print-point [point] (println (str "[" (x-point point) ", " (y-point point) "]")))

(defn make-segment [p1 p2] (list p1 p2))
(defn start-segment [p] (first p))
(defn end-segment [p] (second p))

(make-segment (make-point 2 2) (make-point 3 3))

(defn midpoint-segment [seg]
  (make-point (average (x-point (start-segment seg))
                       (x-point (end-segment seg)))
              (average (y-point (start-segment seg))
                       (y-point (end-segment seg)))))

(print-point (midpoint-segment (make-segment (make-point 2 2)
                                             (make-point 3 3))))</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Exercise 2.3</strong>.  Implement a representation for rectangles in a plane. (Hint: You may want to make use of exercise 2.2.) In terms of your constructors and selectors, create procedures that compute the perimeter and the area of a given rectangle. Now implement a different representation for rectangles. Can you design your system with suitable abstraction barriers, so that the same perimeter and area procedures will work using either representation?</p>
</div>
<div class="paragraph">
<p><strong>Answer 2.3</strong>. A wishful thinking implementation of perimeter and area would be like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn perimeter [rect]
  (* 2 (+ (width rect)
          (height rect))))

(defn area [rect]
  (* (width rect)
     (height rect)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the task is to make different width and height implementations for two representations of rectangle.</p>
</div>
<div class="paragraph">
<p>Representation 1 is just a pair of points representing diagonally opposing corners of the rectangle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn make-rectangle [upper-left-point lower-right-point]
  (list upper-left-point lower-right-point))
(defn upper-left [rectangle] (first rectangle))
(defn lower-right [rectangle] (second rectangle))

(defn height [rect]
  (difference (y-point (upper-left rect))
              (y-point (lower-right rect))))

(defn width [rect]
  (difference (x-point (upper-left rect))
              (x-point (lower-right rect))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Representation 2 is a line segment of the ul to lr diagonal</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn make-rectangle [ulp lrp]
  (make-segment ulp lrp))

(defn height [rect]
  (difference (y-point (start-segment rect))
              (y-point (end-segment rect))))

(defn width [rect]
  (difference (x-point (start-segment rect))
              (x-point (end-segment rect))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not sure I really captured the idea here, the implementations are very similar&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><strong>Exercise 2.4.</strong>  Here is an alternative procedural representation of pairs. For this representation, verify that (car (cons x y)) yields x for any objects x and y.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn cons' [x y]
  (fn [f] (f x y)))

(defn car [g]
  (g (fn [p q] p)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the corresponding definition of cdr? (Hint: To verify that this works, make use of the substitution model of section 1.1.5.)</p>
</div>
<div class="paragraph">
<p><strong>Answer 2.4</strong>. First, lets use substitution on <code>car</code> to see how it works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(car (cons' 2 3))

"Sub out cons for the returned function, closed over its arguments"
(car (fn [m] (m 2 3)))

"Sub out car, which applies the procedure returned by cons onto another function"
((fn [m] (m 2 3)) (fn [p q] p))

"Sub in the car procedure for m in the cons procedure. We end up with just a proc that takes two arguments and returns the first"
((fn [p q] p) 2 3)
((fn [p q] p) 2 3)
2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implication of this is that where <code>car</code> returns the first argument, <code>p</code>, cdr should return the second, <code>q</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn cdr [z]
  (z (fn [p q] q)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The substitution of this is basically identical.</p>
</div>
<div class="paragraph">
<p>What is <code>cons</code> doing here? It&#8217;s closing over its arguments <code>x y</code> and returning a function that <em>takes</em> a function and applies it to <code>x</code> and <code>y</code>. In other words, <code>cons</code> is expecting a function which takes 2 args, and is saying 'hey, here are my 2 elements, do what you want'.</p>
</div>
<div class="paragraph">
<p>The operations on the pairs that cons produces in this model are just applying the pair to a proc. Hence the repeating pattern in <code>car</code> and <code>cdr</code>. We can expand this to an abstract <code>apply-operation</code> function, which can be passed any operation which accepts two arguments, and will apply that to elements of the pair, meaning we can operate on the elements of the pair without having to use <code>car</code> and <code>cdr</code> directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn apply-operation [f] (fn [z] (z f)))
(def car (apply-operation (fn [p q] p)))
(def cdr (apply-operation (fn [p q] p)))

(car (cons' 2 3)) ;;=&gt; 2
(cdr (cons' 2 3)) ;;=&gt; 3
((apply-operation +) (cons' 2 3)) ;;=&gt; 5
((apply-operation *) (cons' 2 3)) ;;=&gt; 6
((apply-operation difference) (cons' 2 3))  ;;=&gt; 1</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Exercise 2.5</strong>.  Show that we can represent pairs of nonnegative integers using only numbers and arithmetic operations if we represent the pair <em>a</em> and <em>b</em> as the integer that is the product <em>2^a</em> <em>3^b</em>. Give the corresponding definitions of the procedures <code>cons</code>, <code>car</code>, and <code>cdr</code>.</p>
</div>
<div class="paragraph">
<p><strong>Answer 2.5</strong>. The <code>cons</code> here is simple: <code>(defn cons [x y] (* (Math/pow 2 x) (Math/pow 3 y)))</code>.</p>
</div>
<div class="paragraph">
<p>The <code>car</code> and <code>cdr</code> here is more complicated. We essentially need to solve the equation <code>2^x * 3^y = c</code> for x and y for each operation respectively.</p>
</div>
<div class="paragraph">
<p>The key observation is that <code>2^x</code> is never divisible by 3, and <code>3^y</code> is never even. So to solve for y we can just divide out 2 until we get something that is <em>not</em> divisible by 2. Then we&#8217;ve eliminated x from the equation, and we have <code>3^y = d</code>, and we can solve for <code>y = log3 d</code>. Similarly for x, we divide out 3.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(defn cons [a b]
  (int (* (Math/pow 2 a) (Math/pow 3 b))))

;; have to define a custom log fn here using the log base change rule.
(defn log [base num]
  (/ (Math/log num)
     (Math/log base)))

(defn cdr [x]
  (if (even? x)
    (cdr (/ x 2))
    (int (log 3 x))))

(defn car [x]
  (if (zero? (mod x 3))
    (car (/ x 3))
    (int (log 2 x))))

(cdr (cons 5 6)) ;;=&gt; 6
(car (cons 5 6)) ;;=&gt; 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: This doesn&#8217;t work for large integers because Java doesn&#8217;t like <code>Mathpow(3, 1024)</code>, but in theory it should work.</p>
</div>
<div class="paragraph">
<p><strong>Exercise 2.6.</strong>  In case representing pairs as procedures wasn&#8217;t mind-boggling enough, consider that, in a language that can manipulate procedures, we can get by without numbers (at least insofar as nonnegative integers are concerned) by implementing 0 and the operation of adding 1 as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-clojure" data-lang="clojure">(def zero (fn [f] (fn [x] x)))

(defn add-1 [n]
  (fn [f] (fn [x] (f ((n f) x)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This representation is known as Church numerals, after its inventor, Alonzo Church, the logician who invented the lambda calculus.</p>
</div>
<div class="paragraph">
<p>Define one and two directly (not in terms of zero and add-1). (Hint: Use substitution to evaluate (add-1 zero)).</p>
</div>
<div class="paragraph">
<p>Give a direct definition of the addition procedure + (not in terms of repeated application of add-1).</p>
</div>
<div class="paragraph">
<p><strong>Answer 2.6</strong>. See blog post <a href="https://redpenguin101.github.io/posts/2021_04_03_church.html">Church Numerals</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-03 20:28:34 +0100
</div>
</div>
</body>
</html>